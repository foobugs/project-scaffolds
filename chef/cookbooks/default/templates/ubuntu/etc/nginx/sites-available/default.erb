server {
  listen 80 default_server;
  server_name <%= @server_name %>;

  access_log /var/log/nginx/<%= @access_log %> combined;
  error_log /var/log/nginx/<%= @error_log %> error;
  
  root <%= @root %>;

  location / {
    autoindex <%= @autoindex %>;
    index <%= @index %>;
  }

  # deny access to .htaccess files
  location ~ /\.ht {
    deny all;
  }

  # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000 or
  # unix:/var/run/php5-fpm.sock
  location ~ \.php$ {
    fastcgi_pass unix:/var/run/php5-fpm.sock;
    fastcgi_split_path_info ^(.+\.php)(/.*)$;

    include fastcgi_params;

    fastcgi_param HTTPS off;
    fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
  }
}

server {
  listen 443 ssl;
  server_name <%= @server_name %>;

  access_log /var/log/nginx/<%= @access_log %> combined;
  error_log /var/log/nginx/<%= @error_log %> error;

  ssl_certificate <%= @ssl_cert %>;
  ssl_certificate_key <%= @ssl_key %>;
  ssl_prefer_server_ciphers on;
  ssl_ciphers AES128-GCM-SHA256:ECDHE-RSA-AES128-SHA256:SSLv3+HIGH:RC4+MEDIUM:!aNULL:!eNULL:!EDH:!3DES:!MD5:@STRENGTH;
  ssl_protocols SSLv3 TLSv1 TLSv1.1 TLSv1.2;
  ssl_session_cache shared:SSL:10m;

  root <%= @root %>;

  location / {
    autoindex <%= @autoindex %>;
    index <%= @index %>;
  }

  # deny access to .htaccess files
  location ~ /\.ht {
    deny all;
  }

  # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000 or
  # unix:/var/run/php5-fpm.sock
  location ~ \.php$ {
    fastcgi_pass unix:/var/run/php5-fpm.sock;
    fastcgi_split_path_info ^(.+\.php)(/.*)$;

    include fastcgi_params;

    fastcgi_param HTTPS on;
    fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
  }
}
